'use strict'

var multicastdns = require('multicast-dns')

module.exports = Server

function Server (opts) {
  this.mdns = multicastdns(opts)
  this.mdns.setMaxListeners(0)
  this.registry = {}
  this.mdns.on('query', this._respondToQuery.bind(this))
}

Server.prototype._respondToQuery = function (query) {
  var self = this
  query.questions.forEach(function (question) {
    var type = question.type
    var answers = type === 'ANY';
    var additionals = []
    self.mdns.respond({ answers: answers, additionals: additionals }, function (err) { if (err) throw err })
  })
}